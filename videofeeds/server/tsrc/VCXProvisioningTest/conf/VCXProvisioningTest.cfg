#***********************************************************************************
#
# STIF test script file for testing service provisioning.
#
#***********************************************************************************

[StifSettings]
CapsModifier= IptvTestClientApiCapsMod.exe
[EndStifSettings]

[Define]
INCLUDE c:\testframework\VCXErrors.inc

PROVISION_ZIP     "c:\testing\data\provisionzip\provision.zip"
UNZIPPED_SERVICE  "c:\testing\data\unzipped_service.xml"
[Enddefine]

[Sub Unpack]
print >>> Unpack
create VCXTestUtilModule Util
Util ExtractFile PROVISION_ZIP PROVISION_FILE UNZIPPED_SERVICE
delete Util
print <<< Unpack
[EndSub]

#------------------------------------------------------------------------------------
#
# Check that external provisioning works with valid xml file. Service type is VOD.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07000 ExternalProvision VOD service
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestVod.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07000
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07000
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file. Service type is VOD.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07003 LocalProvision VOD service
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestVod.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07003
test LocalProvision UNZIPPED_SERVICE
test Verify ET07003
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that external provisioning works with valid xml file. Service type is VC.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07006 ExternalProvision VC service
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestVC.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07006
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07006
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file. Service type is VOD.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07007 LocalProvision VC service
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestVC.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07007
test LocalProvision UNZIPPED_SERVICE
test Verify ET07007
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that external provisioning works with valid xml file. Service is Live TV XMLTV.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07008 ExternalProvision LiveTV XMLTV service
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestXMLTV.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07008
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07008
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file. Service is Live TV XMLTV.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07009 LocalProvision LiveTV XMLTV service
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestXMLTV.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07009
test LocalProvision UNZIPPED_SERVICE
test Verify ET07009
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that external provisioning works with valid xml file. Service is Live TV DVB-IPI.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07010 ExternalProvision LiveTV DVB-IPI service
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestDVBIPI.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07010
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07010
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file. Service is Live TV DVB-IPI.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07011 LocalProvision LiveTV DVB-IPI service
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestDVBIPI.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07011
test LocalProvision UNZIPPED_SERVICE
test Verify ET07011
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that external provisioning works with valid xml file. Service has AccountManagementURI.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07012 ExternalProvision AccountManagementURI
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestAccountManagement.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07012
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07012
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file. Service has AccountManagementURI.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07013 LocalProvision AccountManagementURI
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestAccountManagement.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07013
test LocalProvision UNZIPPED_SERVICE
test Verify ET07013
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that external provisioning works with valid xml file. Service has search URI.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07014 ExternalProvision search URI Rel3
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestSearch.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07014
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07014
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file. Service has search URI.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07015 LocalProvision search URI Rel3
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestSearch.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07015
test LocalProvision UNZIPPED_SERVICE
test Verify ET07015
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that external provisioning works with valid xml file. Service has iap Id.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07016 ExternalProvision Iap Id
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestIapId.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07016
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07016
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file. Service has iap Id.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07017 LocalProvision Iap Id
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestIapId.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07017
test LocalProvision UNZIPPED_SERVICE
test Verify ET07017
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that external provisioning works with valid xml file. Service has iap name.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07018 ExternalProvision Iap name
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestIapName.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07018
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07018
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file. Service has iap name.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07019 LocalProvision Iap name
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestIapName.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07019
test LocalProvision UNZIPPED_SERVICE
test Verify ET07019
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that external provisioning works with valid xml file. Service is Live TV XMLTV.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07020 ExternalProvision LiveTV XMLTV service Account Management
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestAccountManagementLiveTv.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07020
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07020
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file. Service is Live TV XMLTV.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07021 LocalProvision LiveTV XMLTV service Account Management
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestAccountManagementLiveTv.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07021
test LocalProvision UNZIPPED_SERVICE
test Verify ET07021
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvProvisioningProcessor handles invalid filehandle correctly
#
#------------------------------------------------------------------------------------
#[Test]
#title ET07001 ExternalProvision invalid filehandle
#create VCXProvisioningTest test
#test Create
#allownextresult KERRNOTFOUND
#test ExternalProvision "Invalid handle"
#test Destroy
#delete test
#[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvProvisioningProcessor handles parsing invalid xml-files correctly
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07002 ExternalProvision Invalid XMLFile1
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningInvalid1.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
allownextresult EXmlNoElements
test ExternalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvProvisioningProcessor / LocalProvision recovers correctly if the
# asked xml file doesn't exist
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07004 LocalProvision file not found

create VCXProvisioningTest test
test Create
allownextresult KERRNOTFOUND
test LocalProvision "c:\testing\data\there_is_no_such_file.xml"
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvProvisioningProcessor / LocalProvision handles parsing invalid xml-files correctly
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07005 LocalProvision Invalid XMLFile1
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningInvalid1.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
allownextresult EXmlNoElements
test LocalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvProvisioningProcessor / LocalProvision handles parsing invalid xml-files correctly
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07022 LocalProvision VodCast and invalid protocol
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestVCInvalidProtocol.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
allownextresult KERRNOTSUPPORTED
allownextresult 302
test LocalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvProvisioningProcessor / LocalProvision handles parsing invalid xml-files correctly
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07023 LocalProvision Vod and invalid protocol
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestVODInvalidProtocol.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
allownextresult KERRNOTSUPPORTED
allownextresult 302
test LocalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvProvisioningProcessor / LocalProvision handles parsing invalid xml-files correctly
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07024 LocalProvision XMLTV and invalid protocol
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestXMLTVInvalidProtocol.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test LocalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07025 LocalProvision service type Application
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestTypeApplication.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07025
test LocalProvision UNZIPPED_SERVICE
test Verify ET07025
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07026 LocalProvision service type Browser
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestTypeBrowser.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07026
test LocalProvision UNZIPPED_SERVICE
test Verify ET07026
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07038 ExternalProvision service with servicegroup
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestServiceGroup.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07038
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07038
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07039 ExternalProvision servicegroup
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestGroup.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07039
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07039
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07040 LocalProvision service with servicegroup
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestServiceGroup.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07040
test LocalProvision  UNZIPPED_SERVICE
test Verify ET07040
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07041 LocalProvision servicegroup
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestGroup.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07041
test ExternalProvision  UNZIPPED_SERVICE
test Verify ET07041
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with invalid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07027 LocalProvision service type invalid
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestTypeXXX.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
allownextresult KIptvInvalidServiceType
test LocalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with invalid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07028 LocalProvision invalid app UID
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestTInvalidAppUid.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test LocalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07029 LocalProvision empty fields
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestEmptyFields.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
allownextresult KIptvRssParserError
test LocalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvProvisioningProcessor / ExternalProvision handles parsing invalid xml-files correctly
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07030 ExternalProvision VodCast and invalid protocol
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestVCInvalidProtocol.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
allownextresult KERRNOTSUPPORTED
allownextresult 302
test ExternalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvProvisioningProcessor / ExternalProvision handles parsing invalid xml-files correctly
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07031 ExternalProvision Vod and invalid protocol
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestVODInvalidProtocol.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
allownextresult KERRNOTSUPPORTED
allownextresult 302
test ExternalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvProvisioningProcessor / ExternalProvision handles parsing invalid xml-files correctly
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07032 ExternalProvision XMLTV and invalid protocol
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestXMLTVInvalidProtocol.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test ExternalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07033 ExternalProvision service type Application
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestTypeApplication.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07033
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07033
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07034 ExternalProvision service type Browser
var PROVISION_FILE "ValidXMLFiles\VCXProvisioningTestTypeBrowser.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test EnableVerifying ET07034
test ExternalProvision UNZIPPED_SERVICE
test Verify ET07034
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with invalid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07035 ExternalProvision service type invalid
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestTypeXXX.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
allownextresult KIptvInvalidServiceType
test ExternalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with invalid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07036 ExternalProvision invalid app UID
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestTInvalidAppUid.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
test ExternalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that local provisioning works with valid xml file.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET07037 ExternalProvision empty fields
var PROVISION_FILE "InvalidXMLFiles\VCXProvisioningTestEmptyFields.xml"
callsub Unpack

create VCXProvisioningTest test
test Create
allownextresult KIptvRssParserError
test ExternalProvision UNZIPPED_SERVICE
test Destroy
delete test
[Endtest]
