#***********************************************************************************
#
# STIF test script file for testing VOD content client API.
#
#***********************************************************************************

[StifSettings]
CapsModifier= IptvTestClientApiCapsMod.exe
[EndStifSettings]

[Define]
INCLUDE c:\testframework\VCXConsts.inc
INCLUDE c:\testframework\VCXErrors.inc
INCLUDE c:\testframework\VCXVodContentApiTest.inc
INCLUDE c:\testframework\VCXServiceNames.inc
INCLUDE c:\testframework\VCXServiceUpdating.inc
INCLUDE c:\testframework\VCXServiceManagementApiTest.inc
[Enddefine]

#------------------------------------------------------------------------------------
#
# Setup services in service database and delete the EPG db.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET11299 <not a test> Setup search test services

create VCXTestUtilModule Util
// Copies some known 3G AP to "Internet" destination with "Internet" name for the AP.
Util CopyMethod "Internet" "Internet" "Internet"
Util SetMethodPriority DEFAULT_DEST 3G_AP 0
Util SetUsedDestination DEFAULT_DEST
// Disable connection dialog for "Internet" destination.
Util SetConnectionMethodIntAttribute "Internet" "Internet" 507 2 // 507 is ECmSeamlessnessLevel
Util SetDefaultIapCenrep
delete Util

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create
SMTest DeleteAllServices SYNC

// nseries test search
SMTest AddHardCodedService 	ASYNC SERVICE_9	 	3G_AP 1 10 	// OOPS9
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField		ASYNC SERVICE_9 	ESearchUrl	"http:\/\/193.65.182.78/search.php?file=nseries.xml&q=#search#"
SMTest UpdateServiceField		ASYNC SERVICE_9		ESetIapList WLAN_AP 1 3G_AP 1
SMTest UpdateServiceField		ASYNC SERVICE_9 	EName 		EXTRA_SERVICE_1

// no search address
SMTest AddHardCodedService 	ASYNC SERVICE_9	 	3G_AP 1 10 	// OOPS9
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField		ASYNC SERVICE_9		ESetIapList WLAN_AP 1 3G_AP 1
SMTest UpdateServiceField		ASYNC SERVICE_9 	EName 		EXTRA_SERVICE_2

// nseries test search, second
SMTest AddHardCodedService 	ASYNC SERVICE_9	 	3G_AP 1 10 	// OOPS9
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField		ASYNC SERVICE_9 	ESearchUrl	"http:\/\/193.65.182.78/search.php?file=nseries.xml&q=#search#"
SMTest UpdateServiceField		ASYNC SERVICE_9		ESetIapList WLAN_AP 1 3G_AP 1
SMTest UpdateServiceField		ASYNC SERVICE_9 	EName 		EXTRA_SERVICE_3

// search url length is 256 chars
SMTest AddHardCodedService 	ASYNC SERVICE_9	 	3G_AP 1 10 	// OOPS9
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField		ASYNC SERVICE_9 	ESearchUrl	EAddress_256charsLongSearchUrl
SMTest UpdateServiceField		ASYNC SERVICE_9		ESetIapList WLAN_AP 1 3G_AP 1
SMTest UpdateServiceField		ASYNC SERVICE_9 	EName 		EXTRA_SERVICE_4

// search service with parental rating information
SMTest AddHardCodedService 	ASYNC SERVICE_9	 	3G_AP 1 10 	// OOPS9
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/ecg_parental_control.xml"
SMTest UpdateServiceField		ASYNC SERVICE_9 	ESearchUrl	"http:\/\/193.65.182.78/search.php?file=ecg_parental_control.xml&q=#search#"
SMTest UpdateServiceField		ASYNC SERVICE_9		ESetIapList WLAN_AP 1 3G_AP 1
SMTest UpdateServiceField		ASYNC SERVICE_9 	EName 		EXTRA_SERVICE_5

// search service with preview videos
SMTest AddHardCodedService 	ASYNC SERVICE_9	 	3G_AP 1 10 	// OOPS9
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/preview.xml"
SMTest UpdateServiceField		ASYNC SERVICE_9 	ESearchUrl	"http:\/\/193.65.182.78/search.php?file=preview.xml&q=#search#"
SMTest UpdateServiceField		ASYNC SERVICE_9		ESetIapList WLAN_AP 1 3G_AP 1
SMTest UpdateServiceField		ASYNC SERVICE_9 	EName 		EXTRA_SERVICE_6

//SMTest UpdateServiceField		ASYNC SERVICE_9 	ESearchUrl	"http:\/\/video.google.com/videofeed?type=search&q=#search#&so=0&num=10&output=rss"
//SMTest UpdateServiceField		ASYNC SERVICE_9 	ESearchUrl	"http:\/\/api.search.yahoo.com/VideoSearchService/rss/videoSearch.xml?appid=ysearchblog&adult_ok=1&results=10&format=mpeg&query=#search#"
//SMTest UpdateServiceField		ASYNC SERVICE_9 	ESearchUrl	"http:\/\/"

SMTest GetServices SYNC 0 250

SMTest Destroy
delete SMTest
pause 3000
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET11201 Search NSeries 3G
create VCXTestUtilModule Util
Util SetMethodPriority DEFAULT_DEST 3G_AP 0
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap 3G_AP
test Search Amaz
waittestclass test
test EnableVerifying ET11201
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Verify ET11201
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search and update ECG afterwards
#
#------------------------------------------------------------------------------------
[Test]
title ET11224 Search NSeries WLAN and update ECG afterwards
create VCXTestUtilModule Util
Util SetMethodPriority DEFAULT_DEST WLAN_AP 0
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap WLAN_AP
test Search Amaz
waittestclass test
test EnableVerifying ET11224
test VerifyAllCategoryContent 0

pause 3000

test UpdateEcg
waittestclass test
test VerifyAllCategoryContent 0
test Verify ET11224
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient parses data correctly from RSS XML file and ecg db
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET11239 Search - GetEcgList
create VCXTestUtilModule Util
Util SetMethodPriority DEFAULT_DEST 3G_AP 0
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search Amaz
waittestclass test
test GetEcgList KIptvTestSearchCategoryId "" 0 10
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient parses data correctly from RSS XML file and ecg db
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET11240 Search - EcgCategoryList
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search Amaz
waittestclass test
test EcgCategoryList KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient parses data correctly from RSS XML file and ecg db
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET11241 Search - CategoryDetails
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test Create EXTRA_SERVICE_1
test EnableVerifying ET11241
test SelectIap DEFAULT_AP
test Search Amaz
waittestclass test
test CategoryDetails KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient returns parentCategoryId correctly
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET11242 Search - ParentCategory
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search Amaz
waittestclass test
test ParentCategory 0 //KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient parses data correctly from RSS XML file and ecg db
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET11243 Search - ContentDetailsList
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test Create EXTRA_SERVICE_1
test EnableVerifying ET11243
test SelectIap DEFAULT_AP
test Search Amaz
waittestclass test
test ContentDetailsList KIptvRssSearchContentId1
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::SetLastPositionL for Search content
#
#------------------------------------------------------------------------------------
[Test]
title ET11244 SetLastPosition for Search content
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search Amaz
waittestclass test
test SetLastPosition KIptvRssSearchContentId1 0 0
test SetLastPosition KIptvRssSearchContentId1 0 500
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::SetLastPositionL for Search content
#
#------------------------------------------------------------------------------------
[Test]
title ET11245 SetLastPosition for Search content, wrong content index
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search Amaz
waittestclass test
test SetLastPosition KIptvRssSearchContentId1 55 0
test SetLastPosition KIptvRssSearchContentId1 55 500
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search
#
#------------------------------------------------------------------------------------
[Test]
title ET11232 Search no results
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search cantfindthis
waittestclass test
test EnableVerifying ET11232
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Verify ET11232
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test canceling CIptvVodContentClient::Search
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET11221 Cancel Search NSeries
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP

test Search Promo
pause 100
test CancelSearch

pause 60000

test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test canceling CIptvVodContentClient::Search
#
#------------------------------------------------------------------------------------
[Test]
title ET11222 Cancel Search NSeries 2
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP

test Search N
pause 4000
test CancelSearch

pause 60000

test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test canceling CIptvVodContentClient::Search
#
#------------------------------------------------------------------------------------
[Test]
title ET11223 Cancel Search NSeries 3
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP

test Search Promo
test SetMsgWhichToSignal KIptvContentThumbnailDownloaded
//allownextresult KIptvContentThumbnailDownloaded
waittestclass test

test CancelSearch

test Search Promo
waittestclass test

test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test canceling CIptvVodContentClient::Search
#
#------------------------------------------------------------------------------------
[Test]
title ET11252 Cancel Search NSeries 4
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP

test Search N

pause 200

test CancelSearch

pause 5000

test Search Promo
waittestclass test

test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search when thumbnail download is disabled
#
#------------------------------------------------------------------------------------
[Test]
title ET11203 Search NoThumbs
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search Promo
waittestclass test
test EnableVerifying ET11203
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Verify ET11203
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Tests that CIptvVodContentClient::Search results are cleared when the instance is created again.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET11204 After Search
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Repeatedly calls CIptvVodContentClient::Search without waiting the first request to finish.
#
#------------------------------------------------------------------------------------
[Test]
title ET11205 Repeat search
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search Promo
allownextresult KERRNOTREADY
test Search Amaz
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test deleting instance of CIptvVodContentClient when search is ongoing.
#
#------------------------------------------------------------------------------------
[Test]
title ET11206 Delete client while searching
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search Amaz
pause 2000
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test running search when 3G_AP is not set for instance of CIptvVodContentClient.
#
#------------------------------------------------------------------------------------
[Test]
title ET11207 No 3G_AP for search
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
allownextresult KErrCouldNotConnect
test Search Promo
allownextresult KIptvErrorRssSearchNoIap
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search when wrong 3G_AP is set.
#
#------------------------------------------------------------------------------------
[Test]
title ET11208 Wrong 3G_AP
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap INVALID_AP
test Search Promo
allownextresult EIptvDlConnectionFailed
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search when password is wrong.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET11209 Authorization fail

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create

// invalid pw
SMTest AddHardCodedService 	ASYNC SERVICE_9 	3G_AP 1 10 	// invalid service
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField		ASYNC SERVICE_9 	ESearchUrl	"http:\/\/193.65.182.78/search.php?file=nseries.xml&q=#search#"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	EPassword 	"Invaliidipw"
SMTest UpdateServiceField 	ASYNC SERVICE_9		EName 		SERVICE_INVALID_PASSWORD

SMTest Destroy
delete SMTest
pause PAUSE

create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create SERVICE_INVALID_PASSWORD
test SelectIap DEFAULT_AP
test Search Promo
allownextresult EIptvDlAuthFailed
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::UpdateEcgL when CIptvVodContentClient::Search is ongoing.
#
#------------------------------------------------------------------------------------
[Test]
title ET11210 Start ECG update during Search
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search Promo
pause 200
test UpdateEcg
//allownextresult KIptvErrorEpgUpdateFailed
waittestclass test // update
waittestclass test // wait for search
test VerifyAllCategoryContent 0
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::UpdateEcgL when CIptvVodContentClient::Search is ongoing.
#
#------------------------------------------------------------------------------------
[Test]
title ET11211 Start Search during ECG update
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test UpdateEcg
pause 200
test Search Promo
//allownextresult KIptvErrorRssSearchFailed
waittestclass test // search
waittestclass test // wait for update
test VerifyAllCategoryContent 0
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Call CIptvVodContentClient::UpdateEcgL and CIptvVodContentClient::Search few times.
#
#------------------------------------------------------------------------------------
[Test]
title ET11212 Search and update few times
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP

loop 5
print Search 1 - LOOP_COUNTER of 5
test Search Promo
waittestclass test
pause 1000
print Search 2 - LOOP_COUNTER of 5
test Search Promo
waittestclass test
pause 1000
print Update - LOOP_COUNTER of 5
test UpdateEcg
waittestclass test
endloop

test VerifyAllCategoryContent 0
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test update and search and dump the database content into a file.
#
#------------------------------------------------------------------------------------
[Test]
title ET11213 Search and update, dump content
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP

test Search Promo
waittestclass test
pause 1000

test UpdateEcg
waittestclass test

test VerifyAllCategoryContent 0
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search when the service has no search URL
#
#------------------------------------------------------------------------------------
[Test]
title ET11215 Try Search when no search URL
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_2
test SelectIap DEFAULT_AP

allownextresult KERRNOTSUPPORTED
test Search Amaz
allownextresult KERRNOTSUPPORTED
waittestclass test

print Update 2

test UpdateEcg
waittestclass test

test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search. Search URL file does not exist on the server.
#
#------------------------------------------------------------------------------------
[Test]
title ET11216 Wrong search URL 1

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create

allowerrorcodes SMEServiceNotFound
allowerrorcodes KERRARGUMENT
SMTest DeleteService SYNC SERVICE_INVALID_URL1
// invalid search url
SMTest AddHardCodedService 	ASYNC SERVICE_9 	3G_AP 1 10 	// invalid service
SMTest UpdateServiceField	ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	ESearchUrl 	"http:\/\/www.google.com/test123456789.xml?q=#search#"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	EName 		SERVICE_INVALID_URL1

SMTest Destroy
delete SMTest
pause PAUSE

create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create SERVICE_INVALID_URL1
test SelectIap DEFAULT_AP
test Search Amaz
allownextresult EIptvDlContentNotFound
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search. Search URL server does not exist.
#
#------------------------------------------------------------------------------------
[Test]
title ET11217 Wrong search URL 2

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create

allowerrorcodes SMEServiceNotFound
allowerrorcodes KERRARGUMENT
SMTest DeleteService SYNC SERVICE_INVALID_URL1
// invalid search url
SMTest AddHardCodedService 	ASYNC SERVICE_9 	3G_AP 1 10 	// invalid service
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	ESearchUrl 	"http:\/\/www.xxx12346567xxxabc.fi/test123456789.xml?q=#search#"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	EName 		SERVICE_INVALID_URL1

SMTest Destroy
delete SMTest
pause PAUSE

create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create SERVICE_INVALID_URL1
test SelectIap DEFAULT_AP
test Search Amaz
allownextresult EIptvDlContentNotFound
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search. Search URL protocol is malformed.
#
#------------------------------------------------------------------------------------
[Test]
title ET11218 Wrong search URL 3

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create

allowerrorcodes SMEServiceNotFound
allowerrorcodes KERRARGUMENT
SMTest DeleteService SYNC SERVICE_INVALID_URL1
//invalid search url
SMTest AddHardCodedService 	ASYNC SERVICE_9 	3G_AP 1 10		// invalid service
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	ESearchUrl 	"hXttp:\/\/www.kaatuilee.com/test123456789.xml?q=#search#"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	EName 		SERVICE_INVALID_URL1

SMTest Destroy
delete SMTest
pause PAUSE

create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create SERVICE_INVALID_URL1
test SelectIap DEFAULT_AP
test Search Amaz
allownextresult EIptvDlContentNotFound
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search. Search URL points to JPG binary file.
#
#------------------------------------------------------------------------------------
[Test]
title ET11219 Wrong search URL 4
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create

allowerrorcodes SMEServiceNotFound
allowerrorcodes KERRARGUMENT
SMTest DeleteService SYNC SERVICE_INVALID_URL1
// wrong search url2
SMTest AddHardCodedService 	ASYNC SERVICE_9	 	3G_AP 1 10 	// OOPS9
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField		ASYNC SERVICE_9 	ESearchUrl	"http:\/\/193.65.182.78/Nseries/image1.JPG"
SMTest UpdateServiceField		ASYNC SERVICE_9 	EName 		SERVICE_INVALID_URL1

SMTest Destroy
delete SMTest
pause PAUSE


create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create SERVICE_INVALID_URL1
test SelectIap DEFAULT_AP
test Search Amaz
allownextresult EIptvDlContentNotFound
allownextresult KIptvRssParserError
waittestclass test

//
// Update service search to valid url and search again
//

create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest UpdateServiceField		ASYNC SERVICE_INVALID_URL1 	ESearchUrl	"http:\/\/193.65.182.78/search.php?file=nseries.xml&q=#search#"
IptvTest Destroy
delete IptvTest

test Search Amaz
waittestclass test

test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search. Search URL is not formed according to the search URL template.
#
#------------------------------------------------------------------------------------
[Test]
title ET11236 Wrong search URL 5

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create

allowerrorcodes SMEServiceNotFound
allowerrorcodes KERRARGUMENT
SMTest DeleteService SYNC SERVICE_INVALID_URL1
// invalid search url
SMTest AddHardCodedService 	ASYNC SERVICE_9 	3G_AP 1 10 	// invalid service
SMTest UpdateServiceField	ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	ESearchUrl 	"http:\/\/193.65.182.78/search.php?file=nseries.xml&q="
SMTest UpdateServiceField 	ASYNC SERVICE_9 	EName 		SERVICE_INVALID_URL1

SMTest Destroy
delete SMTest
pause PAUSE

create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create SERVICE_INVALID_URL1
test SelectIap DEFAULT_AP
test Search Amaz
//allownextresult EIptvDlContentNotFound
//allownextresult KIptvRssParserError
waittestclass test
test EnableVerifying ET11236
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search. The format of downloaded file from Search URL is not in right format.
#
#------------------------------------------------------------------------------------
[Test]
title ET11237 Wrong search URL 6

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create

allowerrorcodes SMEServiceNotFound
allowerrorcodes KERRARGUMENT
SMTest DeleteService SYNC SERVICE_INVALID_URL1
// invalid search url
SMTest AddHardCodedService 	ASYNC SERVICE_9 	3G_AP 1 10 	// invalid service
SMTest UpdateServiceField   ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	ESearchUrl 	"http:\/\/193.65.182.78/dvbtest/xmltv/yle1day.xml"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	EName 		SERVICE_INVALID_URL1

SMTest Destroy
delete SMTest
pause PAUSE

create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create SERVICE_INVALID_URL1
test SelectIap DEFAULT_AP
test Search Amaz
allownextresult KIptvRssParserError
allownextresult EIptvDlContentNotFound
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search. Search URL points to a RTSP stream.
#
#------------------------------------------------------------------------------------
[Test]
title ET11238 Wrong search URL 7

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create

allowerrorcodes SMEServiceNotFound
allowerrorcodes KERRARGUMENT
SMTest DeleteService SYNC SERVICE_INVALID_URL1
// invalid search url
SMTest AddHardCodedService 	ASYNC SERVICE_9 	3G_AP 1 10 	// invalid service
SMTest UpdateServiceField		ASYNC SERVICE_9 	EAddress 	"http:\/\/193.65.182.78/nseries.xml"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	ESearchUrl 	"rtsp:\/\/mobile.live.sonera.com/ftp/yle/yle24/video/uusin.3gp"
SMTest UpdateServiceField 	ASYNC SERVICE_9 	EName 		SERVICE_INVALID_URL1

SMTest Destroy
delete SMTest
pause PAUSE

create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create SERVICE_INVALID_URL1
test SelectIap DEFAULT_AP
test Search Amaz
allownextresult EIptvDlContentNotFound
allownextresult KIptvRssParserError
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search
#
#------------------------------------------------------------------------------------
[Test]
title ET11220 Search special chars
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP
test Search KBadCharacters
waittestclass test
test Search "@£${[]}\\!#§%&/()="
waittestclass test
test Search "?`~^*®'®'‰ˆ÷≈ƒ~eÔ"
waittestclass test
test Search "Ωß,.-;:_+/*<>|‰Â‰Â"
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::CancelSearch
#
#------------------------------------------------------------------------------------
[Test]
title ET11226 CancelSearch when no search
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP

test CancelSearch

test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::CancelSearch
#
#------------------------------------------------------------------------------------
[Test]
title ET11227 Repeat CancelSearch
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP

test CancelSearch
test CancelSearch

test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::CancelSearch
#
#------------------------------------------------------------------------------------
[Test]
title ET11228 CancelSearch when ECG update ongoing, no search
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP

test UpdateEcg
pause 2000

test CancelSearch

waittestclass test

test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::CancelSearch
#
#------------------------------------------------------------------------------------
[Test]
title ET11229 CancelSearch when ECG update and search are ongoing
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test SelectIap DEFAULT_AP

test UpdateEcg
pause 500
test Search Amaz
pause 500
test CancelSearch

waittestclass test

test VerifyAllCategoryContent 0

test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search
#
#------------------------------------------------------------------------------------
[Test]
title ET11230 Search 3G and update ECG WLAN
create VCXTestUtilModule Util
Util SetMethodPriority DEFAULT_DEST WLAN_AP 0
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1

test SelectIap WLAN_AP
test UpdateEcg
pause 500

test SelectIap 3G_AP
test Search Amaz

waittestclass test // update and search
waittestclass test

test VerifyAllCategoryContent 0

test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test deleting instance of CIptvVodContentClient when search and ECG update are ongoing.
#
#------------------------------------------------------------------------------------
[Test]
title ET11231 Delete client while ECG search and update are ongoing
create VCXTestUtilModule Util
Util SetMethodPriority DEFAULT_DEST 3G_AP 0
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1

test SelectIap DEFAULT_AP

test UpdateEcg
pause 1000

test Search Amaz
pause 1000

test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test getting update time after search.
#
#------------------------------------------------------------------------------------
[Test]
title ET11233 Search and GetUpdateTime
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DisableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_1
test GetUpdateTime // database is empty
test SelectIap DEFAULT_AP
test UpdateEcg
waittestclass test
test Search Amaz
waittestclass test
test GetUpdateTime 3
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search
#
#------------------------------------------------------------------------------------
[Test]
title ET11234 Two searches at the same time
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE

create VCXVodContentApiTest test
create VCXVodContentApiTest test2

test EnableThumbnails
test DeleteEpgDb

test Create EXTRA_SERVICE_1
test2 Create EXTRA_SERVICE_3

test SelectIap DEFAULT_AP
test2 SelectIap DEFAULT_AP

test Search Amaz
test2 Search Pro

waittestclass test

pause 7000

test VerifyAllCategoryContent KIptvTestSearchCategoryId

test2 VerifyAllCategoryContent KIptvTestSearchCategoryId

test Destroy
test2 Destroy

delete test
delete test2

Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search against service with parental rating information.
#
#------------------------------------------------------------------------------------
[Test]
title ET11246 Search parental rating - limit 18
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test SetParentalControlAge 18
test Create EXTRA_SERVICE_5
test SelectIap DEFAULT_AP
test Search "1" // returns few videos, couple with age rating 18 or over
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search against service with parental rating information.
#
#------------------------------------------------------------------------------------
[Test]
title ET11247 Search parental rating - limit 1
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test SetParentalControlAge 1
test Create EXTRA_SERVICE_5
test SelectIap DEFAULT_AP
test Search "1" // returns few videos, couple with age rating 18 or over
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search against service with parental rating information.
#
#------------------------------------------------------------------------------------
[Test]
title ET11248 Search parental rating - no limit
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test SetParentalControlAge 0
test Create EXTRA_SERVICE_5
test SelectIap DEFAULT_AP
test Search "1" // returns few videos, couple with age rating 18 or over
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search
#
#------------------------------------------------------------------------------------
[Test]
title ET11251 Search and preview
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_6
test SelectIap DEFAULT_AP
test Search "preview download"
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search when long search URL is combined with long search query.
#
#------------------------------------------------------------------------------------
[Test]
title ET11235 Search url over 256 characters
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create
SMTest GetServices SYNC 0 250
SMTest Destroy
delete SMTest

pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_4
test SelectIap DEFAULT_AP
//allownextresult KERROVERFLOW
test Search AmazingAmazingAma
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::Search when long search URL is combined with long search query.
#
#------------------------------------------------------------------------------------
[Test]
title ET11253 Search url over 2k characters
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create
SMTest UpdateServiceField		ASYNC EXTRA_SERVICE_4 	ESearchUrl	EAddress_2kLongUrl
SMTest GetServices SYNC 0 250
SMTest Destroy
delete SMTest

pause PAUSE
create VCXVodContentApiTest test
test EnableThumbnails
test DeleteEpgDb
test Create EXTRA_SERVICE_4
test SelectIap DEFAULT_AP
//allownextresult KERROVERFLOW
test Search AmazingAmazingAma
allownextresult EIptvDlContentNotFound
waittestclass test
test VerifyAllCategoryContent KIptvTestSearchCategoryId
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]
