#***********************************************************************************
#
# STIF test script file for testing VOD content client API.
#
#***********************************************************************************

[StifSettings]
CapsModifier= IptvTestClientApiCapsMod.exe
[EndStifSettings]

[Define]
INCLUDE c:\testframework\VCXConsts.inc
INCLUDE c:\testframework\VCXErrors.inc
INCLUDE c:\testframework\VCXVodContentApiTest.inc
INCLUDE c:\testframework\VCXServiceNames.inc
INCLUDE c:\testframework\VCXServiceUpdating.inc
[Enddefine]

#------------------------------------------------------------------------------------
#
# Setup services in service database and delete the EPG db.
#
#------------------------------------------------------------------------------------
[Test]
title ET11399 <not a test> Setup error test services

create VCXTestUtilModule Util
// Copies some known 3G AP to "Internet" destination with "Internet" name for the AP.
Util CopyMethod "Internet" "Internet" "Internet"
Util SetMethodPriority DEFAULT_DEST 3G_AP 0
Util SetUsedDestination DEFAULT_DEST
// Disable connection dialog for "Internet" destination.
Util SetConnectionMethodIntAttribute "Internet" "Internet" 507 2 // 507 is ECmSeamlessnessLevel
Util SetDefaultIapCenrep
delete Util

pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest DeleteAllServices SYNC

IptvTest AddHardCodedService 	ASYNC SERVICE_0 3G_AP 1 0
IptvTest UpdateServiceField 	ASYNC	SERVICE_0	ESetIapList WLAN_AP 1 3G_AP 1

IptvTest AddHardCodedService 	ASYNC SERVICE_1 3G_AP 1 1
IptvTest UpdateServiceField 	ASYNC	SERVICE_1	ESetIapList WLAN_AP 1 3G_AP 1

IptvTest AddHardCodedService 	ASYNC SERVICE_2 3G_AP 1 1
IptvTest UpdateServiceField 	ASYNC	SERVICE_2	ESetIapList WLAN_AP 1 3G_AP 1

IptvTest AddHardCodedService 	ASYNC SERVICE_10 	3G_AP 1 3 		// invalid service
IptvTest UpdateServiceField 	ASYNC	SERVICE_10	ESetIapList WLAN_AP 1 3G_AP 1
IptvTest UpdateServiceField 	ASYNC SERVICE_10 	EName 		SERVICE_INVALID_URL1
IptvTest UpdateServiceField 	ASYNC SERVICE_INVALID_URL1 	EAddress 	"http:\/\/www.google.com/test123456789.xml"

IptvTest AddHardCodedService 	ASYNC SERVICE_10 	3G_AP 1 4 		// invalid service
IptvTest UpdateServiceField 	ASYNC	SERVICE_10	ESetIapList WLAN_AP 1 3G_AP 1
IptvTest UpdateServiceField 	ASYNC SERVICE_10 	EName 		SERVICE_INVALID_URL2
IptvTest UpdateServiceField 	ASYNC SERVICE_INVALID_URL2 	EAddress 	"http:\/\/www.xxx12346567xxxabc.fi/test123456789.xml"

IptvTest AddHardCodedService 	ASYNC SERVICE_10 	3G_AP 1 5 		// invalid service
IptvTest UpdateServiceField 	ASYNC	SERVICE_10	ESetIapList WLAN_AP 1 3G_AP 1
IptvTest UpdateServiceField 	ASYNC SERVICE_10	EName 		SERVICE_INVALID_PASSWORD
IptvTest UpdateServiceField 	ASYNC SERVICE_INVALID_PASSWORD 	EPassword 	"Invaliidipw"

IptvTest AddHardCodedService 	ASYNC SERVICE_10 	3G_AP 1 6 		// invalid service
IptvTest UpdateServiceField 	ASYNC	SERVICE_10	ESetIapList WLAN_AP 1 3G_AP 1
IptvTest UpdateServiceField 	ASYNC SERVICE_10 	EName 		SERVICE_INVALID_URL3
IptvTest UpdateServiceField 	ASYNC SERVICE_INVALID_URL3 	EAddress 	"hXttp:\/\/www.kaatuilee.com/test123456789.xml"

IptvTest AddHardCodedService 	ASYNC SERVICE_10 	3G_AP 1 2 		// nseries
IptvTest UpdateServiceField 	ASYNC	SERVICE_10	ESetIapList WLAN_AP 1 3G_AP 1

IptvTest GetServices 0 0 200

IptvTest Destroy
delete IptvTest
pause 3000
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvVodContentClient handles UpdateEcgL request correctly when no IAP is selected and ECG DB is empty.
#
#------------------------------------------------------------------------------------
[Test]
title ET11323 UpdateEcg No iap selected SERVICE_0
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DeleteEpgDb
test Create SERVICE_0
test UpdateEcg
allownextresult KIptvErrorVodNoIap
waittestclass test
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvVodContentClient handles GetEcgListL request correctly when no IAP is selected and ECG DB is empty.
#
#------------------------------------------------------------------------------------
[Test]
title ET11324 GetEcgList No iap selected SERVICE_0
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_0
test GetEcgList 1 "" 0 10
allownextresult KIptvErrorVodNoIap
waittestclass test
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvVodContentClient handles GetEcgCategoryListL request correctly when no IAP is selected and ECG DB is empty.
#
#------------------------------------------------------------------------------------
[Test]
title ET11325 EcgCategoryList No iap selected SERVICE_0
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_0
test EcgCategoryList 0
allownextresult KIptvErrorVodNoIap
waittestclass test
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvVodContentClient handles GetEcgAllListL request correctly when no IAP is selected and ECG DB is empty.
#
#------------------------------------------------------------------------------------
[Test]
title ET11326 EcgEcgAllList No iap selected SERVICE_0
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_0
test EcgEcgAllList "" 0 5
allownextresult KIptvErrorVodNoIap
waittestclass test
test EcgEcgAllList "" 0 5
pause 10000
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvVodContentClient handles GetCategoryDetailsL request correctly when no IAP is selected and ECG DB is empty.
#
#------------------------------------------------------------------------------------
[Test]
title ET11327 CategoryDetails No iap selected SERVICE_0
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_0
//allownextresult KIptvErrorVodNoIap
test CategoryDetails 1
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvVodContentClient handles GetParentCategoryL request correctly when no IAP is selected.
#
#------------------------------------------------------------------------------------
[Test]
title ET11328 ParentCategory No iap selected SERVICE_0
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_0
test ParentCategory 0
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that IptvVodContentClient handles GetContentDetailsL request correctly when no IAP is selected and ECG DB is empty.
#
#------------------------------------------------------------------------------------
[Test]
title ET11329 ContentDetailsList No iap selected SERVICE_0
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_0
//allownextresult KIptvErrorVodNoIap
test ContentDetailsList 0
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that updating ecg works. Content needed in next cases.
#
#------------------------------------------------------------------------------------
[Test]
title ET11339 UpdateEcg SERVICE_10
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_10
test SelectIap DEFAULT_AP
test UpdateEcg
waittestclass test
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::SetLastPositionL
#
#------------------------------------------------------------------------------------
[Test]
title ET11344 SetLastPosition invalid content index
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_10
test SetLastPosition 1000 500 0
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test CIptvVodContentClient::SetLastPositionL
#
#------------------------------------------------------------------------------------
[Test]
title ET11345 SetLastPosition invalid content access index
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_10
test SetLastPosition 0 100 500
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient handles GetEcgListL request with invalid category id.
#
#------------------------------------------------------------------------------------
[Test]
title ET11337 GetEcgList invalid category id SERVICE_10
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_10
test SelectIap DEFAULT_AP
test GetEcgList 100 "" 0 10
test GetEcgList 0 "" 5 10
test GetEcgList 100 "" 10 1
test GetEcgList 100 "" 500 5
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient handles GetEcgCategoryListL request with invalid category ID.
#
#------------------------------------------------------------------------------------
[Test]
title ET11338 EcgCategoryList invalid category id SERVICE_10
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_10
test SelectIap DEFAULT_AP
test EcgCategoryList 100
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient handles GetCategoryDetailsL request with invalid category ID.
#
#------------------------------------------------------------------------------------
[Test]
title ET11340 CategoryDetails invalid category id SERVICE_10
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_10
test SelectIap DEFAULT_AP
test CategoryDetails 100
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient returns parentCategoryId correctly
#
#------------------------------------------------------------------------------------
[Test]
title ET11341 ParentCategory invalid category id SERVICE_10
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_10
test SelectIap DEFAULT_AP
test ParentCategory 100
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient handles GetContentDetailsL request with invalid category id.
#
#------------------------------------------------------------------------------------
[Test]
title ET11342 ContentDetailsList invalid category id SERVICE_10
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_10
test SelectIap DEFAULT_AP
test ContentDetailsList 1000
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient recovers when it's created with invalid serviceid
#
#------------------------------------------------------------------------------------
[Test]
title ET11314 CIptvVodContentClient Invalid service
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
allownextresult KERRNOTFOUND
test Create 10000
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient recovers when the service has invalid URL, the www server exists and returns 404.
#
#------------------------------------------------------------------------------------
[Test]
title ET11330 UpdateEcg service with invalid url
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_INVALID_URL1
test SelectIap DEFAULT_AP
test UpdateEcg
allownextresult EIptvDlContentNotFound
waittestclass test
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient recovers when the service has invalid URL, the www server does not exist.
#
#------------------------------------------------------------------------------------
[Test]
title ET11331 UpdateEcg service with invalid url 2
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_INVALID_URL2
test SelectIap DEFAULT_AP
test UpdateEcg
//allownextresult EIptvDlGeneral
allownextresult EIptvDlContentNotFound
waittestclass test
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient recovers when service has wrong password.
#
#------------------------------------------------------------------------------------
[Test]
title ET11332 UpdateEcg service with invalid password
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_INVALID_PASSWORD
test SelectIap DEFAULT_AP
test UpdateEcg
allownextresult EIptvDlAuthFailed
waittestclass test
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that updating ecg recovers if (valid)IAP is not available
#
#------------------------------------------------------------------------------------
[Test]
title ET11315 UpdateEcg via not available IAP SERVICE_2
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher

pause PAUSE
create VCXServiceManagementApiTest SMTest
SMTest Create
SMTest UpdateServiceField SYNC SERVICE_2 ESetIapList 3G_AP 0 // Vod content will use this AP instead

pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_2
test SelectIap BAD_AP
test UpdateEcg
allownextresult KIptvErrorEpgUpdateFailed
allownextresult EIptvDlConnectionFailed
waittestclass test

test SelectIap DEFAULT_AP
test UpdateEcg
waittestclass test
test GetEcgList 1 "" 0 10
test Destroy
delete test

SMTest Destroy
delete SMTest

Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Testname:ET11335 GetEcgList while updating ECG SERVICE_0
#
#------------------------------------------------------------------------------------
[Test]
title ET11335 GetEcgList while updating ECG SERVICE_0
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test Create SERVICE_0
test SelectIap DEFAULT_AP
test UpdateEcg
test GetEcgList 1 "" 0 10
test Destroy
delete test
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Check that CIptvVodContentClient recovers when the service URL's protocol is invalid.
#
#------------------------------------------------------------------------------------
[Test]
title ET11343 UpdateEcg service with invalid url 3
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
pause PAUSE
create VCXVodContentApiTest test
test DeleteEpgDb
test Create SERVICE_INVALID_URL3
test SelectIap DEFAULT_AP

test UpdateEcg
//allownextresult EIptvDlGeneral
allownextresult KIptvErrorEpgUpdateFailed
allownextresult EIptvDlContentNotFound
waittestclass test

test Destroy
delete test

// crashed ast least before
pause 10000

Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Try to update ecg from invalid webaddress
#
#------------------------------------------------------------------------------------
[Test]
title ET11346 Update ecg from invalid webaddress
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest DeleteAllServices SYNC
IptvTest AddHardCodedService ASYNC SERVICE_1 3G_AP 1
IptvTest UpdateServiceField 	ASYNC	SERVICE_1	ESetIapList WLAN_AP 1 3G_AP 1
IptvTest UpdateServiceField ASYNC SERVICE_1 EAddress "http:\/\/www.edcba/abcd.xml"
IptvTest UpdateServiceField ASYNC SERVICE_1 EName SERVICE_1
create VCXVodContentApiTest IptvVCTest
IptvVCTest Create SERVICE_1
IptvVCTest SelectIap DEFAULT_AP
IptvVCTest UpdateEcg
allownextresult EIptvDlContentNotFound
waittestclass IptvVCTest
IptvTest Destroy
IptvVCTest Destroy
delete IptvTest
delete IptvVCTest
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Test changing service address while ECG is updated
#
#------------------------------------------------------------------------------------
[Test]
title ET11349 Change service address while ECG is updated
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
create VCXServiceManagementApiTest IptvTest

IptvTest Create
IptvTest DeleteAllServices SYNC
IptvTest AddHardCodedService ASYNC SERVICE_1 3G_AP 1
IptvTest UpdateServiceField ASYNC	SERVICE_1 ESetIapList WLAN_AP 1 3G_AP 1
IptvTest UpdateServiceField ASYNC SERVICE_1 EAddress "http:\/\/193.65.182.78/oops.xml"

create VCXVodContentApiTest IptvVCTest

IptvVCTest Create SERVICE_1
IptvVCTest SelectIap DEFAULT_AP

IptvVCTest UpdateEcg
waittestclass IptvVCTest

IptvVCTest UpdateEcg
pause 1000
IptvTest UpdateServiceField ASYNC SERVICE_1 EAddress "http:\/\/193.65.182.78/yle.xml"
allownextresult EIptvDlGeneral
waittestclass IptvVCTest

IptvVCTest UpdateEcg
waittestclass IptvVCTest

IptvVCTest EnableVerifying ET11349
IptvVCTest GetEcgList 1 "" 0 10
IptvVCTest Verify ET11349

IptvTest Destroy
IptvVCTest Destroy
delete IptvTest
Util CheckMobilecrashes
delete Util
[Endtest]

#------------------------------------------------------------------------------------
#
# Download a file which can be downloaded but isn't valid rss -xml file
#
#------------------------------------------------------------------------------------
[Test]
title ET11347 Update ecg with non-xml file
create VCXTestUtilModule Util
Util CreateMobilecrashWatcher
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest DeleteAllServices SYNC
IptvTest AddHardCodedService ASYNC SERVICE_1 3G_AP 1
IptvTest UpdateServiceField ASYNC	SERVICE_1	ESetIapList WLAN_AP 1 3G_AP 1
IptvTest UpdateServiceField ASYNC SERVICE_1 EAddress "http:\/\/193.65.182.78/nokia_vod/bar.JPG"
create VCXVodContentApiTest IptvVCTest
IptvVCTest Create SERVICE_1
IptvVCTest SelectIap DEFAULT_AP
IptvVCTest UpdateEcg
allownextresult KIptvRssParserError
waittestclass IptvVCTest
IptvTest Destroy
IptvVCTest Destroy
delete IptvTest
Util CheckMobilecrashes
delete Util
[Endtest]
