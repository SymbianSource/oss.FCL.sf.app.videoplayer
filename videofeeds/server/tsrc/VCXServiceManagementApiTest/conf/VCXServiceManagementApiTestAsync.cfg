#***********************************************************************************
#
# STIF test script file for testing service management client API.
#
#***********************************************************************************

[StifSettings]
CapsModifier= IptvTestClientApiCapsMod.exe
[EndStifSettings]

[Define]
INCLUDE c:\testframework\VCXConsts.inc
INCLUDE c:\testframework\VCXServiceManagementApiTest.inc
INCLUDE c:\testframework\VCXServiceUpdating.inc
INCLUDE c:\testframework\VCXServiceNames.inc
INCLUDE c:\testframework\VCXErrors.inc
[Enddefine]

#------------------------------------------------------------------------------------
#
# Setup case. Test adding a service.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET08203 Setup Add valid hardcoded service_0 ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest DeleteAllServices SYNC
IptvTest AddHardCodedService ASYNC SERVICE_0 2 1 0
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that updating a service works.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET08204 Update service fields ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest UpdateServiceField ASYNC SERVICE_0 EFlags ESelected EReadOnly EMainService EConnectionApproved EReadOnlyIaps
IptvTest UpdateServiceField ASYNC SERVICE_0 EName "Updated Service Name"
IptvTest UpdateServiceField ASYNC "Updated Service Name" EName SERVICE_0
IptvTest UpdateServiceField ASYNC SERVICE_0 EAddress "http:\/\/www.UpdatedServiceaddress.com"
IptvTest UpdateServiceField ASYNC SERVICE_0 EIconPath "c:\\UpdatedIconPath"
IptvTest UpdateServiceField ASYNC SERVICE_0 EEpgPluginUid 12345
IptvTest UpdateServiceField ASYNC SERVICE_0 EVodPluginUid 23456
IptvTest UpdateServiceField ASYNC SERVICE_0 EIptvPluginUid 34567
IptvTest UpdateServiceField ASYNC SERVICE_0 EServiceType EVodCast
IptvTest UpdateServiceField ASYNC SERVICE_0 ESetIapList 3
IptvTest UpdateServiceField ASYNC SERVICE_0 EUserName "Updated USER Name"
IptvTest UpdateServiceField ASYNC SERVICE_0 EPassword "Updated PASSWORD"
IptvTest UpdateServiceField ASYNC SERVICE_0 EDesc "Updated Service description"
IptvTest UpdateServiceField ASYNC SERVICE_0 EFlags ESelected EReadOnly EMainService EConnectionApproved EReadOnlyIaps
IptvTest UpdateServiceField ASYNC SERVICE_0 EApplicationUid 12
IptvTest UpdateServiceField ASYNC SERVICE_0 EDisplayOrder 111
IptvTest UpdateServiceField ASYNC SERVICE_0 EProviderId "UPDPROVID"
IptvTest UpdateServiceField ASYNC SERVICE_0 EAccountManagementUrl "http:\/\/updatedaccountmanagmenturl.com"
pause 3000
IptvTest GetServices ASYNC 0 2
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Add few valid hardcoded services for later use.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET08206 Setup Add valid hardcoded services ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest AddHardCodedService ASYNC SERVICE_1 2 1 1
IptvTest AddHardCodedService ASYNC SERVICE_2 2 1 2
IptvTest AddHardCodedService ASYNC SERVICE_3 2 1 3
IptvTest AddHardCodedService ASYNC SERVICE_4 2 1 4
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that updating service works.
#
#------------------------------------------------------------------------------------
[Test]
title ET08207 Update valid service ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest UpdateService ASYNC SERVICE_1 SERVICE_2
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that updating service with same data functions correctly.
#
#------------------------------------------------------------------------------------
[Test]
title ET08209 Update same valid service ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest UpdateService ASYNC SERVICE_2 SERVICE_2
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that getting services by index works.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET08210 Get services by index ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest GetServices ASYNC 0 5000
IptvTest GetServices ASYNC 0 2
IptvTest GetServices ASYNC 1 1
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that deleting a service works.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET08214 Delete service ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest DeleteService ASYNC SERVICE_0
//IptvTest DeleteService ASYNC 1
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that adding service with 15 iaps works. Maximum iap limit in CIptvIapList is 10 and this will fail.
#
#------------------------------------------------------------------------------------
[Test]
title ET08216 Add service with 15 iaps ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
allownextresult KERRARGUMENT
IptvTest AddHardCodedService ASYNC SERVICE_15IAPS 2 1
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test deleting all the services.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET08217 Delete all services ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest DeleteAllServices ASYNC
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Add services to be used in later cases.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET08218 Add valid services 2 ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest AddHardCodedService ASYNC SERVICE_0 3 1 0
IptvTest AddHardCodedService ASYNC SERVICE_1 3 1 1
IptvTest AddHardCodedService ASYNC SERVICE_2 3 1 2
IptvTest AddHardCodedService ASYNC SERVICE_3 3 1 3
IptvTest AddHardCodedService ASYNC SERVICE_4 3 1 4
IptvTest AddHardCodedService ASYNC SERVICE_5 3 1 5
IptvTest AddHardCodedService ASYNC SERVICE_6 3 1 6
IptvTest AddHardCodedService ASYNC SERVICE_7 3 1 7
IptvTest AddHardCodedService ASYNC SERVICE_8 3 1 8
IptvTest AddHardCodedService ASYNC SERVICE_9 3 1 9
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that getting services by filter works.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET08219 Get filtered services ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest UpdateServiceField ASYNC SERVICE_0 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_1 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_2 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_3 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_4 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_5 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_6 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_7 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_8 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_9 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_0 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_1 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_2 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_3 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_4 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_5 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_6 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_7 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_8 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_9 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_1 EFlags EReadOnly EReadOnlyIaps
IptvTest UpdateServiceField ASYNC SERVICE_2 EFlags EReadOnly EReadOnlyIaps
IptvTest UpdateServiceField ASYNC SERVICE_4 EFlags EReadOnly EReadOnlyIaps
IptvTest UpdateServiceField ASYNC SERVICE_6 EFlags EReadOnly EReadOnlyIaps
IptvTest GetServicesFiltered ASYNC 6 EDisplayOrderAscending ESearchSelectedServices
IptvTest UpdateServiceField ASYNC SERVICE_1 EFlags EMainService
IptvTest UpdateServiceField ASYNC SERVICE_2 EFlags EMainService EReadOnlyIaps
IptvTest UpdateServiceField ASYNC SERVICE_4 EFlags EMainService
IptvTest UpdateServiceField ASYNC SERVICE_6 EFlags EMainService EConnectionApproved
IptvTest UpdateServiceField ASYNC SERVICE_8 EFlags EMainService
IptvTest GetServicesFiltered ASYNC 5 EDisplayOrderAscending ESearchMainServices
IptvTest GetServicesFiltered ASYNC 5 EDisplayOrderAscending ESearchSubServices
IptvTest GetServicesFiltered ASYNC 10 EDisplayOrderAscending ESearchNoFlags
IptvTest UpdateServiceField ASYNC SERVICE_0 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_1 EServiceType ELiveTv
IptvTest UpdateServiceField ASYNC SERVICE_2 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_3 EServiceType ELiveTv
IptvTest UpdateServiceField ASYNC SERVICE_4 EServiceType ELiveTv
IptvTest UpdateServiceField ASYNC SERVICE_5 EServiceType ELiveTv
IptvTest UpdateServiceField ASYNC SERVICE_6 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_7 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_8 EServiceType ELiveTv
IptvTest UpdateServiceField ASYNC SERVICE_9 EServiceType EVod
IptvTest GetServicesFiltered ASYNC 5 EDisplayOrderAscending ESearchVod
IptvTest GetServicesFiltered ASYNC 5 EDisplayOrderAscending ESearchLiveTv
IptvTest UpdateServiceField ASYNC SERVICE_0 EServiceType EOther
IptvTest UpdateServiceField ASYNC SERVICE_3 EServiceType EOther
IptvTest UpdateServiceField ASYNC SERVICE_4 EServiceType EOther
IptvTest UpdateServiceField ASYNC SERVICE_6 EServiceType EVodCast
IptvTest UpdateServiceField ASYNC SERVICE_1 EServiceType EVodCast
IptvTest UpdateServiceField ASYNC SERVICE_3 EServiceType EVodCast
IptvTest GetServicesFiltered ASYNC 2 EDisplayOrderAscending ESearchOther
IptvTest GetServicesFiltered ASYNC 3 EDisplayOrderAscending ESearchVodCast
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Call GetServicesFiltered with different sort argument.
#
# CaseClass: core
#------------------------------------------------------------------------------------
[Test]
title ET08265 Get filtered services sorted ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest GetServicesFiltered ASYNC 3 EDateAscending ESearchVodCast
IptvTest GetServicesFiltered ASYNC 3 EDateDescending ESearchVodCast
IptvTest GetServicesFiltered ASYNC 3 EDisplayOrderAscending ESearchVodCast
IptvTest GetServicesFiltered ASYNC 3 EDisplayOrderDescending ESearchVodCast
allownextresult SMEGeneralError
IptvTest GetServicesFiltered ASYNC 3 7 ESearchVodCast
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that GetUsedIap method works.
#
#------------------------------------------------------------------------------------
[Test]
title ET08221 GetUsedIap ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest SetUsedIap SERVICE_1 3G_AP
IptvTest GetServices ASYNC 0 5000
IptvTest GetUsedIap ASYNC SERVICE_1 3G_AP
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that SetAllIaps method works.
#
#------------------------------------------------------------------------------------
#[Test]
#title ET08222 SetAllIaps ASYNC
#pause PAUSE
#create VCXServiceManagementApiTest IptvTest
#IptvTest Create
#IptvTest SetAllIaps ASYNC 5 1
#IptvTest Destroy
#delete IptvTest
#[Endtest]

#------------------------------------------------------------------------------------
#
# Verify that server is shutdown when it has no active clients.
#
#------------------------------------------------------------------------------------
[Test]
title ET08223 Verify server is shutdown ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest GetServices ASYNC 0 5000
pause 10000
pause 10000
IptvTest Destroy
delete IptvTest
pause 10000
create VCXServiceManagementApiTest IptvTest
IptvTest VerifyServerIsShutdown
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that canceling add service request to server works.
#
#------------------------------------------------------------------------------------
[Test]
title ET08224 Cancel request. Add service ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest AddHardCodedService ASYNC SERVICE_2 2 1 0
IptvTest AddHardCodedService ASYNC SERVICE_2 2 1 1
IptvTest AddHardCodedService ASYNC SERVICE_3 2 1 2
IptvTest AddHardCodedService ASYNC SERVICE_4 2 1 3
IptvTest SetSpecialAction EIptvSmCancelNextAsyncRequest
IptvTest AddHardCodedService ASYNC SERVICE_0 2 1 -1
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that canceling update service request to server works.
#
#------------------------------------------------------------------------------------
[Test]
title ET08225 Cancel request. Update service ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest SetSpecialAction EIptvSmCancelNextAsyncRequest
IptvTest UpdateService ASYNC SERVICE_1 SERVICE_2
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that canceling get services by index request to server works.
#
#------------------------------------------------------------------------------------
[Test]
title ET08226 Cancel request. Get services by index ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest SetSpecialAction EIptvSmCancelNextAsyncRequest
//allownextresult KERRGENERAL
IptvTest GetServices ASYNC 0 5000
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that canceling GetUsedIap request to server works.
#
#------------------------------------------------------------------------------------
[Test]
title ET08227 Cancel request. Get used iap ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest SetSpecialAction EIptvSmCancelNextAsyncRequest
allownextresult KERRCORRUPT
IptvTest GetUsedIap ASYNC SERVICE_0 3G_AP
IptvTest SetSpecialAction EIptvSmCancelNextAsyncRequest
IptvTest SetUsedIap SERVICE_0 3G_AP
IptvTest SetSpecialAction EIptvSmCancelNextAsyncRequest
allownextresult KERRCORRUPT
IptvTest GetUsedIap ASYNC SERVICE_0 3G_AP
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test that canceling delete service request to server works.
#
#------------------------------------------------------------------------------------
[Test]
title ET08229 Cancel request. Delete service ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest SetSpecialAction EIptvSmCancelNextAsyncRequest
IptvTest DeleteService ASYNC SERVICE_5
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test sending two add service requests to the server w/o waiting the first one to complete.
#
#------------------------------------------------------------------------------------
[Test]
title ET08230 Repeat add service ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest RepeatNextRequest 2
IptvTest AddHardCodedService ASYNC SERVICE_0 2 1 -1
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test sending two update service requests to the server w/o waiting the first one to complete.
#
#------------------------------------------------------------------------------------
[Test]
title ET08231 Repeat update service request ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest RepeatNextRequest 2
IptvTest UpdateServiceField ASYNC SERVICE_7 EUserName "Updated User Name"
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Test sending two get services requests to the server w/o waiting the first one to complete.
#
#------------------------------------------------------------------------------------
[Test]
title ET08232 Repeat get services by index ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest RepeatNextRequest 2
IptvTest GetServices ASYNC 0 5000
IptvTest Destroy
delete IptvTest
[Endtest]


#------------------------------------------------------------------------------------
#
# Test sending two delete service requests to the server w/o waiting the first one to complete.
#
#------------------------------------------------------------------------------------
[Test]
title ET08233 Repeat delete service ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest AddHardCodedService ASYNC SERVICE_1 2 1
IptvTest RepeatNextRequest 2
allownextresult SMEServiceNotFound
IptvTest DeleteService ASYNC SERVICE_1
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Repeat getting services by filter request to the server w/o waiting the first one to complete.
#
#------------------------------------------------------------------------------------
[Test]
title ET08235 Repeat get filtered services ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
IptvTest DeleteAllServices SYNC
IptvTest AddHardCodedService ASYNC SERVICE_0 2 1 0
IptvTest AddHardCodedService ASYNC SERVICE_1 2 1 1
IptvTest AddHardCodedService ASYNC SERVICE_2 2 1 2
IptvTest UpdateServiceField ASYNC SERVICE_0 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_1 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_2 EFlags EConnectionApproved ESelected
IptvTest UpdateServiceField ASYNC SERVICE_0 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_1 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_2 EServiceType EVod
IptvTest UpdateServiceField ASYNC SERVICE_2 EFlags EReadOnly EReadOnlyIaps
IptvTest UpdateServiceField ASYNC SERVICE_0 EFlags EMainService
IptvTest UpdateServiceField ASYNC SERVICE_2 EFlags EMainService EReadOnlyIaps
IptvTest RepeatNextRequest 2
IptvTest GetServicesFiltered ASYNC 1 EDisplayOrderAscending ESearchSelectedServices
IptvTest Destroy
delete IptvTest
[Endtest]

#------------------------------------------------------------------------------------
#
# Send shutdown request to the server.
#
# Note: This fails because it's not supported.
#
#------------------------------------------------------------------------------------
[Test]
title ET08236 Shutdown server ASYNC
pause PAUSE
create VCXServiceManagementApiTest IptvTest
IptvTest Create
allownextresult 2
IptvTest ShutdownServer ASYNC
IptvTest Destroy
delete IptvTest
[Endtest]
